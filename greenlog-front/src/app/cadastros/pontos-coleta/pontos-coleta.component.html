<app-topbar></app-topbar>
<app-sidebar></app-sidebar>

<!-- Modal com o componente -->
<app-bairros
  [visivel]="mostrarModalBairros"
  (fechado)="fecharModalBairros()">
</app-bairros>

<div class="form-container">
  <h2>{{ idEditando !== null ? 'Editar' : 'Cadastro de' }} Ponto de Coleta</h2>

  <form (ngSubmit)="onSubmit(pontoColetaForm)" #pontoColetaForm="ngForm">
    <div class="form-group">
      <label for="bairroId">Bairro:</label>
      <input id="bairroId" name="bairroId" type="number" [(ngModel)]="pontoColetaAtual.bairroId" placeholder="ID do Bairro (tempor√°rio)" required #bairroIdInput="ngModel"
             [ngClass]="{ 'invalid-input': bairroIdInput.invalid && (bairroIdInput.dirty || bairroIdInput.touched) }">
      <button (click)="abrirModalBairros()" class="btn abrir-modal">‚ûï Cadastrar Bairros</button>
      <div *ngIf="bairroIdInput.invalid && (bairroIdInput.dirty || bairroIdInput.touched)" class="error-message">
        <small *ngIf="bairroIdInput.errors?.['required']">Bairro √© obrigat√≥rio.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="nome">Nome do Ponto:</label>
      <input id="nome" name="nome" [(ngModel)]="pontoColetaAtual.nome" type="text" placeholder="Ex: Centro Comunit√°rio" required minlength="3" #nomeInput="ngModel"
             [ngClass]="{ 'invalid-input': nomeInput.invalid && (nomeInput.dirty || nomeInput.touched) }">
      <div *ngIf="nomeInput.invalid && (nomeInput.dirty || nomeInput.touched)" class="error-message">
        <small *ngIf="nomeInput.errors?.['required']">Nome √© obrigat√≥rio.</small>
        <small *ngIf="nomeInput.errors?.['minlength']">Nome deve ter no m√≠nimo 3 caracteres.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="responsavel">Respons√°vel:</label> <input id="responsavel" name="responsavel" [(ngModel)]="pontoColetaAtual.responsavel" type="text" placeholder="Nome completo do respons√°vel" required minlength="3" #respInput="ngModel"
             [ngClass]="{ 'invalid-input': respInput.invalid && (respInput.dirty || respInput.touched) }">
      <div *ngIf="respInput.invalid && (respInput.dirty || respInput.touched)" class="error-message">
        <small *ngIf="respInput.errors?.['required']">Respons√°vel √© obrigat√≥rio.</small>
        <small *ngIf="respInput.errors?.['minlength']">Respons√°vel deve ter no m√≠nimo 3 caracteres.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="telefoneResponsavel">Telefone do Respons√°vel:</label>
      <input id="telefoneResponsavel" name="telefoneResponsavel" [(ngModel)]="pontoColetaAtual.telefoneResponsavel" type="text" placeholder="Ex: (62) 99999-9999">
    </div>

    <div class="form-group">
      <label for="emailResponsavel">Email do Respons√°vel:</label>
      <input type="email" placeholder="Ex: email@dominio.com"
       name="emailResponsavel"
       [(ngModel)]="pontoColetaAtual.emailResponsavel"
       #email="ngModel"
       required
       class="form-control" />
      <div *ngIf="email.invalid && email.touched" class="text-danger">
        Por favor, informe um e-mail v√°lido.
      </div>
    </div>

    <div class="form-group">
      <label for="endereco">Endere√ßo:</label>
      <input id="endereco" name="endereco" [(ngModel)]="pontoColetaAtual.endereco" type="text" placeholder="Ex: Rua X, Qd. Y, Lt. Z, Setor W">
    </div>

    <div class="form-group">
      <label for="horarioFuncionamento">Hor√°rio de Funcionamento:</label>
      <input id="horarioFuncionamento" name="horarioFuncionamento" [(ngModel)]="pontoColetaAtual.horarioFuncionamento" type="text" placeholder="Ex: Seg-Sex 08:00-18:00">
    </div>

    <div class="form-group">
      <label>Tipos de Res√≠duos Aceitos: (Selecione ao menos um)</label>
      <div class="checkbox-group">
        <div *ngFor="let tipo of opcoesTiposResiduos" class="checkbox-item">
          <input type="checkbox"
                 id="tipo-{{tipo}}"
                 name="tipo-{{tipo}}"
                 [value]="tipo"
                 [checked]="tiposResiduosSelecionados[tipo]"
                 (change)="onTipoResiduoChange(tipo, $event)">
          <label class="checkbox-label" for="tipo-{{tipo}}">{{ tipo }}</label>
        </div>
      </div>
    </div>

    <div *ngIf="mensagemErro" class="error-message api-error">
      {{ mensagemErro }}
    </div>
    <div *ngIf="mensagemSucesso" class="success-message api-success">
      {{ mensagemSucesso }}
    </div>

    <div class="button-group">
      <button type="submit" class="btn salvar" [disabled]="pontoColetaForm.invalid || pontoColetaAtual.tiposResiduosAceitos.length === 0">
        üíæ {{ idEditando !== null ? 'Atualizar' : 'Salvar' }}
      </button>
      <button type="button" *ngIf="idEditando !== null" class="btn cancelar" (click)="finalizarEdicao(pontoColetaForm)">
        ‚ùå Cancelar Edi√ß√£o
      </button>
    </div>
  </form>
</div>

<hr />
<h3>Pontos de Coleta Cadastrados:</h3>

<table class="tabela-dados"> <thead>
    <tr>
      <th>ID Bairro</th>
      <th>Nome</th>
      <th>Respons√°vel</th>
      <th>Telefone</th>
      <th>Email</th>
      <th>Endere√ßo</th>
      <th>Funcionamento</th>
      <th>Tipos Res√≠duos</th>
      <th>A√ß√µes</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let pc of pontosColeta">
      <td>{{ pc.bairroId }}</td> <td>{{ pc.nome }}</td>
      <td>{{ pc.responsavel }}</td>
      <td>{{ pc.telefoneResponsavel }}</td>
      <td>{{ pc.emailResponsavel }}</td>
      <td>{{ pc.endereco }}</td>
      <td>{{ pc.horarioFuncionamento }}</td>
      <td>{{ pc.tiposResiduosAceitos.join(', ') }}</td>
      <td>
        <button class="btn editar" (click)="editarPontoColeta(pc)">‚úèÔ∏è Editar</button>
        <button class="btn excluir" (click)="excluirPontoColeta(pc.id)">üóëÔ∏è Excluir</button>
      </td>
    </tr>
    <tr *ngIf="pontosColeta.length === 0">
        <td colspan="9" style="text-align: center;">Nenhum ponto de coleta cadastrado.</td>
    </tr>
  </tbody>
</table>